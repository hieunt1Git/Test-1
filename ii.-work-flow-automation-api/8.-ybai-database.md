# 8. Ybai - Database

## Tá»•ng quan

Data tá»« há»‡ thá»‘ng gá»­i mail form YBai trá» vá» cÃ¡c há»‡ thá»‘ng khÃ¡c Ä‘á»ƒ gá»­i tin ZNS hoáº·c bÃ¡n khÃ³a há»c. Há»‡ thá»‘ng cÅ© sáº½ cÃ³ data trÃªn lark Ä‘Ã£ remove vá» gg sheet.

## TÃ i nguyÃªn

{% embed url="https://docs.google.com/spreadsheets/d/15GQ9a1KslI8e5ulKolCFNQvmMnGjHBuJpyp8YzMX7Fg/edit?gid=1003479578#gid=1003479578" %}

## Set Up

<figure><img src="https://cnvloyalty.sg.larksuite.com/space/api/box/stream/download/asynccode/?code=ZTM5MjAzNGEzODE3OTlkZjZkNzI4ZjA3NzIxMTkwZDJfUmdsZTZmTXpGOGVINmpXNVUzWldYTDljNlZyMFdXeVhfVG9rZW46RngxcGJVdVNSb05TWXp4Ym54QWwzZGhhZ2ljXzE3NTQzNzY1NjQ6MTc1NDM4MDE2NF9WNA" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/image (17).png" alt=""><figcaption></figcaption></figure>

```javascript
function doPost(e) {
  try {
    // 1ï¸âƒ£ Log raw JSON nháº­n tá»« webhook
    Logger.log("ğŸ“© RAW JSON: " + e.postData.contents);

    // 2ï¸âƒ£ Parse JSON
    var json = JSON.parse(e.postData.contents);
    Logger.log("âœ… Parsed JSON: " + JSON.stringify(json));

    var data = json.data; // Láº¥y object data
    Logger.log("ğŸ“¦ Data object: " + JSON.stringify(data));

    // 3ï¸âƒ£ Láº¥y file Google Sheet
    var sheetId = "15GQ9a1KslI8e5ulKolCFNQvmMnGjHBuJpyp8YzMX7Fg";
    var sheet = SpreadsheetApp.openById(sheetId).getSheetByName("TB1. Form Ybai");

    // 4ï¸âƒ£ Láº¥y cÃ¡c trÆ°á»ng cáº§n ghi vÃ  log tá»«ng trÆ°á»ng
    var customerName = data.customer_name || "";
    Logger.log("ğŸ‘¤ customer_name: " + customerName);

    var customerMobile = data.customer_mobile || "";
    Logger.log("ğŸ“ customer_mobile: " + customerMobile);

    var customerEmail = data.customer_email || "";
    Logger.log("ğŸ“§ customer_email: " + customerEmail);

    var description = data.description || "";
    Logger.log("ğŸ“ description: " + description);

    var modelType = data.model_type || "";
    Logger.log("ğŸ“‚ model_type: " + modelType);

    var createdAt = data.created_at || "";
    Logger.log("â° created_at: " + createdAt);

    var affiliateFullName = data.affiliate ? data.affiliate.full_name : "";
    Logger.log("ğŸ¤ affiliate.full_name: " + affiliateFullName);

    // 5ï¸âƒ£ Ghi dá»¯ liá»‡u vÃ o sheet theo thá»© tá»± Ä‘Ã£ yÃªu cáº§u
    sheet.appendRow([
      customerName,        // 1. customer full name
      "'" + customerMobile, // 2. customer mobile (thÃªm ' Ä‘á»ƒ giá»¯ sá»‘ 0)
      customerEmail,       // 3. customer mail
      description,         // 4. description
      modelType,           // 5. model type
      createdAt,           // 6. created_at
      affiliateFullName    // 7. affiliate full name
    ]);

    Logger.log("âœ… ÄÃ£ ghi dá»¯ liá»‡u thÃ nh cÃ´ng vÃ o Sheet.");

    // 6ï¸âƒ£ Tráº£ pháº£n há»“i JSON cho webhook
    return ContentService
      .createTextOutput(JSON.stringify({ status: "success", logged: true }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    Logger.log("âŒ Lá»–I khi xá»­ lÃ½ doPost: " + err);

    return ContentService
      .createTextOutput(JSON.stringify({ status: "error", message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

```
