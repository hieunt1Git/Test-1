# 3. GG sheet - Lark

## Tá»•ng quan

Váº«n lÃ  webhook nhÆ°ng pháº£i viáº¿t code má»™t tÃ­ Ä‘á»ƒ tÃ¹y chá»‰nh tÃ¹y theo loáº¡i thÃ´ng tin muá»‘n báº¯n._Má»¥c Ä‘Ã­ch cá»§a luá»“ng nÃ y lÃ  cÃ³ thá»ƒ tÃ­ch há»£p cÃ¡c data trÃªn gg sheet vá» lark base Ä‘áº» quáº£n lÃ½ vÃ  cÃ³ thá»ƒ tÃ­ch há»£p gá»­i Ä‘áº¿n cÃ¡c ná»n táº£ng khÃ¡c nhÆ° CNV CDP, ladiflow, Ybai,... Ä‘á»ƒ chÄƒm khÃ¡ch hÃ ng sau khi cÃ³ thÃ´ng tin._

## Set up

<figure><img src="../.gitbook/assets/image (38).png" alt=""><figcaption></figcaption></figure>

**Äáº§u tiÃªn GG Sheet:** Thanh cÃ´ng cá»¥ chá»n **Extensions -> App Scrip ->** past Code app scrip á»Ÿ dÆ°á»›i vÃ´ tinh chá»‰nh cho phÃ¹ há»£p vá»›i sheet muá»‘n báº¯n thÃ´ng tin**Note:** CÃ³ thá»ƒ past vÃ o AI Ä‘á»ƒ thay Ä‘á»•i. Promt custom trÃªn AI: Ai sáº½ thay Ä‘á»•i thÃ´ng tin trong code Ä‘á»ƒ phÃ¹ há»£p vá»›i tá»«ng sheet cá»¥ thá»ƒ." Äiá»u chá»‰nh Ä‘oáº¡n code sau thay URL webhook :**< thÃªm wehook muá»‘n báº¯n thÃ´ng tin>**, Sheet name :**< TÃªn Sheet chá»©a thÃ´ng tin. Ex: Data khÃ¡ch hÃ ng>;** CÃ¡c trÆ°á»ng :**< A,B,C,D EX: TÃªn, SdT, Email,...>**

```javascript
// Code App Scpip. báº¯n Data tá»« GG sheet SocialHeart
function onChange(e) {
  Logger.log("ğŸ” Sá»± kiá»‡n onChange Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t."); // Kiá»ƒm tra xem sá»± kiá»‡n cÃ³ Ä‘Æ°á»£c kÃ­ch hoáº¡t khÃ´ng
  const sheet = e.source.getActiveSheet();
  const sheetName = "SOCIALHEART";
  if (sheet.getName() !== sheetName) {
    Logger.log(âš ï¸ Trang tÃ­nh hiá»‡n táº¡i khÃ´ng pháº£i lÃ  ${sheetName}.);
    return;
  }
  const range = e.source.getActiveRange();
  const row = range.getRow();
  Logger.log(ğŸ“Œ HÃ ng Ä‘Æ°á»£c chá»‰nh sá»­a hoáº·c thÃªm dá»¯ liá»‡u: ${row});
  if (row > 1) {
    Logger.log("âœ… Äang láº¥y dá»¯ liá»‡u tá»« hÃ ng má»›i...");
    const rowData = sheet.getRange(row, 1, 1, 16).getValues()[0]; // Láº¥y dá»¯ liá»‡u tá»« hÃ ng má»›i
    Logger.log(ğŸ“Š Dá»¯ liá»‡u nháº­n Ä‘Æ°á»£c: ${JSON.stringify(rowData)});

    const webhookUrl = "https://cnvloyalty.larksuite.com/base/automation/webhook/event/JO49atIqGwpqsxh7zxWuoFsIszg"; // URL Webhook cá»§a Boss

    const payload = {
      id: rowData[0],
      createDate: rowData[1],
      name: rowData[2],
      uid: rowData[3],
      phone: rowData[4],
      email: rowData[5],
      gender: rowData[6],
      keyword: rowData[7],
      relationship: rowData[8],
      dob: rowData[9],
      city: rowData[10],
      district: rowData[11],
      postId: rowData[12],
      postContent: rowData[13],
      syncEmail: rowData[14],
      syncZalo: rowData[15]
    };

    Logger.log(ğŸ“¦ Payload chuáº©n bá»‹ gá»­i Ä‘i: ${JSON.stringify(payload)});

    const options = {
      method: "post",
      contentType: "application/json",
      muteHttpExceptions: true,
      payload: JSON.stringify(payload)
    };

    try {
      const response = UrlFetchApp.fetch(webhookUrl, options);
      const responseCode = response.getResponseCode();
      const responseText = response.getContentText();

      if (responseCode === 200) {
        Logger.log(âœ… Dá»¯ liá»‡u gá»­i thÃ nh cÃ´ng cho ID: ${rowData[0]});
      } else {
        Logger.log(âš ï¸ Lá»—i khi gá»­i dá»¯ liá»‡u cho ID: ${rowData[0]} - MÃ£ lá»—i: ${responseCode} - Pháº£n há»“i: ${responseText});
      }
    } catch (error) {
      Logger.log(âŒ Lá»—i khi gá»­i dá»¯ liá»‡u cho ID: ${rowData[0]} - ${error});
    }
  } else {
    Logger.log("ğŸ›‘ KhÃ´ng cÃ³ dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c gá»­i Ä‘i vÃ¬ hÃ ng nhá» hÆ¡n hoáº·c báº±ng 1.");
  }
}
```

Sau Ä‘Ã³ set up má»™t Trigger. **Extensions -> App Scrip ->Triggers**

<figure><img src="https://cnvloyalty.sg.larksuite.com/space/api/box/stream/download/asynccode/?code=NWY4Y2U5NDZkOTZkNTZiYjUzZjRkYmU0OTM0MzE5YzVfTFBIbHdDNEtEVFNxbDM1bmVpY2RLZ2p4WUJwaWc2WkpfVG9rZW46RUduWmJWS3Z4b3hYZWt4aDhpOHVsWHN0c1NkXzE3NTM4NjU5MTA6MTc1Mzg2OTUxMF9WNA" alt=""><figcaption></figcaption></figure>

**Sau Ä‘Ã³ set up má»™t trigger tÆ°Æ¡ng tá»± nhÆ° hÃ¬nh dÆ°á»›i**

<figure><img src="https://cnvloyalty.sg.larksuite.com/space/api/box/stream/download/asynccode/?code=NjVkN2YzNGNhMmQ5YWU2NDhjOTVhM2MwZmU1MjBhZmJfSXJqR1NhVDFzSWNSNFhVUG5MNjByZEtpVldmVm54RDlfVG9rZW46WW5iZmJiUU9Sb0ZmZW94dVhVV3U3Q2ZWc1hiXzE3NTM4NjU5MzQ6MTc1Mzg2OTUzNF9WNA" alt=""><figcaption></figcaption></figure>

Táº¡i nÆ¡i nháº­n vÃ­ dá»¥ nhÆ° lark base trong base: VÃ o **Base** -> Chá»n **automation ->Táº¡o automation má»›i -> Step 1 When webhook received -> Táº¡i Manual Set Up pasr code Json nháº­n**

```json
//Code Json nháº­n
{
  "id": "11",
  "createDate": "2025-03-11",
  "name": "Nguyen Van A",
  "uid": "123456789",
  "phone": "+84901234567",
  "email": "example@gmail.com",
  "gender": "Male",
  "keyword": "Marketing, Sales",
  "relationship": "Single",
  "dob": "1990-01-01",
  "city": "Hanoi",
  "district": "Dong Da",
  "postId": "ABC123XYZ",
  "postContent": "This is a sample post content.",
  "syncEmail": "Yes",
  "syncZalo": "No"
}
```

**Step 2 Add record: Thiáº¿t láº­p cÃ¡c trÆ°á»ng cáº§n thiáº¿t.**

<figure><img src="https://cnvloyalty.sg.larksuite.com/space/api/box/stream/download/asynccode/?code=NWE0ZGE3NzFkYTg0NjI2NjhiNjVhMDA3MGU3YTYwMDNfdmh3RmhhUWlGUHNuT3N1M21kcEJqc3JzS3ZibkdBVWhfVG9rZW46U0lnS2JKbkRhbzdpaWd4cFl0THVTMXhWc05GXzE3NTM4NjYwMjU6MTc1Mzg2OTYyNV9WNA" alt=""><figcaption></figcaption></figure>
